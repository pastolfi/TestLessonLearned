sap.ui.define([
		"sap/ui/core/mvc/Controller",
		"sap/m/MessageBox",
		"./Popover2",
		"./utilities",
		"sap/ui/core/routing/History"
	], function (BaseController, MessageBox, Popover2, Utilities, History) {
		"use strict";
		return BaseController.extend("com.sap.build.standard.llMd.controller.DetailPage3", {
			handleRouteMatched: function (oEvent) {
				var sAppId = "App5cfe0bb752e93a3710524b07";
				var oParams = {};
				this._oRootView = this.getOwnerComponent().getAggregation("rootControl");
				this._oRootView.getController().setMode(sap.m.SplitAppMode.HideMode);
				if (oEvent.mParameters.data.context) {
					this.sContext = oEvent.mParameters.data.context;
				} else {
					if (this.getOwnerComponent().getComponentData()) {
						var patternConvert = function (oParam) {
							if (Object.keys(oParam).length !== 0) {
								for (var prop in oParam) {
									if (prop !== "sourcePrototype" && prop.includes("Set")) {
										return prop + "(" + oParam[prop][0] + ")";
									}
								}
							}
						};
						this.sContext = patternConvert(this.getOwnerComponent().getComponentData().startupParameters);
					}
				}
				var oPath;
				if (this.sContext) {
					oPath = {
						path: "/" + this.sContext,
						parameters: oParams
					};
					this.getView().bindObject(oPath);
				}
			},
			_onTableItemPress: function (oEvent) {
				/*var sPopoverName = "Popover2";
					this.mPopovers = this.mPopovers || {};
					var oPopover = this.mPopovers[sPopoverName];
					if (!oPopover) {
						oPopover = new Popover2(this.getView());
						this.mPopovers[sPopoverName] = oPopover;
						oPopover.getControl().setPlacement("Auto");
						// For navigation.
						oPopover.setRouter(this.oRouter);
					}
					var oSource = oEvent.getParameter("listItem");
					oPopover.open(oSource);*/
				var oItem, oCtx;
				oItem = oEvent.getParameter("listItem");
				//oEvent.getSource();
				oCtx = oItem.getBindingContext();
				this.getOwnerComponent().getRouter().navTo("AttachEvent", {
					ProductID: oCtx.getProperty("ProductID"),
					ProductName: oCtx.getProperty("ProductName")
				});
			},
			_onButtonPress: function () {
				var oHistory = History.getInstance();
				var sPreviousHash = oHistory.getPreviousHash();
				var oQueryParams = this.getQueryParameters(window.location);
				if (sPreviousHash !== undefined || oQueryParams.navBackToLaunchpad) {
					window.history.go(-1);
				} else {
					var oRouter = sap.ui.core.UIComponent.getRouterFor(this);
					oRouter.navTo("default", true);
				}
			},
			getQueryParameters: function (oLocation) {
				var oQuery = {};
				var aParams = oLocation.search.substring(1).split("&");
				for (var i = 0; i < aParams.length; i++) {
					var aPair = aParams[i].split("=");
					oQuery[aPair[0]] = decodeURIComponent(aPair[1]);
				}
				return oQuery;
			},
			onInit: function () {
				this.oRouter = sap.ui.core.UIComponent.getRouterFor(this);
				this.oRouter.getTarget("DetailPage3").attachDisplay(jQuery.proxy(this.handleRouteMatched, this));
				var oView = this.getView();
				oView.addEventDelegate({
					onBeforeShow: function () {
						if (sap.ui.Device.system.phone) {
							var oPage = oView.getContent()[0];
							if (oPage.getShowNavButton && !oPage.getShowNavButton()) {
								oPage.setShowNavButton(true);
								oPage.attachNavButtonPress(function () {
									this.oRouter.navTo("Popover1", {}, true);
								}.bind(this));
							}
						}
					}.bind(this)
				}); //this.byId("EventTable").bindRows("/Products");
				//this.getOwnerComponent().getView().byId("EventTable").bindRows("/Products");
			},
			/**
			 *@memberOf com.sap.build.standard.llMd.controller.DetailPage3
			 */
			onSearchButton: function (oEvent) {
				//This code was generated by the layout editor.
				var oParam1 = this.byId("param1");
				var oParam2 = this.byId("param2");
				var oParam3 = this.byId("param3");
				var oParam4 = this.byId("param4");
				var filters = [];
				if (oParam1.getValue() !== "") {
					filters.push(new sap.ui.model.Filter("ProductID", sap.ui.model.FilterOperator.EQ, oParam1.getValue()));
				}
				if (oParam2.getValue() !== "") {
					filters.push(new sap.ui.model.Filter("ProductName", sap.ui.model.FilterOperator.Contains, oParam2.getValue()));
				}
				if (oParam3.getValue() !== "") {
					filters.push(new sap.ui.model.Filter("UnitPrice", sap.ui.model.FilterOperator.LT, oParam3.getValue()));
				}
				var oTable = this.byId("EventTable");
				var oTemplate = new sap.m.ColumnListItem({
					cells: [
						new sap.m.ObjectIdentifier({
							text: "{ProductID}"
						}),
						new sap.m.Text({
							text: "{ProductName}"
						}),
						new sap.m.ObjectNumber({
							number: "{UnitPrice}"
						})
					]
				});
				oTable.bindAggregation("items", {
					path: "/Products",
					template: oTemplate,
					filters: filters
				});
			},
			/**
			 *@memberOf com.sap.build.standard.llMd.controller.DetailPage3
			 */
			action: function (oEvent) {
				var that = this;
				var actionParameters = JSON.parse(oEvent.getSource().data("wiring").replace(/'/g, "\""));
				var eventType = oEvent.getId();
				var aTargets = actionParameters[eventType].targets || [];
				aTargets.forEach(function (oTarget) {
					var oControl = that.byId(oTarget.id);
					if (oControl) {
						var oParams = {};
						for (var prop in oTarget.parameters) {
							oParams[prop] = oEvent.getParameter(oTarget.parameters[prop]);
						}
						oControl[oTarget.action](oParams);
					}
				});
				var oNavigation = actionParameters[eventType].navigation;
				if (oNavigation) {
					var oParams = {};
					(oNavigation.keys || []).forEach(function (prop) {
						oParams[prop.name] = encodeURIComponent(JSON.stringify({
							value: oEvent.getSource().getBindingContext(oNavigation.model).getProperty(prop.name),
							type: prop.type
						}));
					});
					if (Object.getOwnPropertyNames(oParams).length !== 0) {
						this.getOwnerComponent().getRouter().navTo(oNavigation.routeName, oParams);
					} else {
						this.getOwnerComponent().getRouter().navTo(oNavigation.routeName);
					}
				}
			}
		});
	}, /* bExport= */
	true);